@page "/"

<div id="container">
    <CameraStreamer @ref=CameraStreamerReference
                Width=640
                Height=360
                OnRendered=OnRenderedHandler
                OnFrame=OnFrameHandler
                Style="width: 100%; height: 100%;"
                CameraID=@cameraId
                Autostart />
    <div id="frame" style=@trackingStyle/>
 </div>
 <div id="mood">@moodText</div>

<div>
    <button @onclick=Start>
        Start
    </button>
    <button @onclick=Stop>
        Stop
    </button>
     <button @onclick=GetCurrentFrame>
         Get Current Frame
     </button>
</div>

<br />

 <style>

     body {
         background-color: @htmlColor;
     }

 </style>

@code
 {
    private CameraStreamer CameraStreamerReference;

    private string cameraId = null;

    private string imageData;

    private string trackingStyle = "";

    private string moodText = "Neutral";

    private string htmlColor = "grey";

    private async void OnRenderedHandler()
    {

        // Check camera-access or ask user, if it's not allowed currently
        if (await CameraStreamerReference.GetCameraAccessAsync())
        {
            // Reloading re-initializes the stream and starts the
            // stream automatically if the Autostart parameter is set
            await CameraStreamerReference.ReloadAsync();

            // If Autostart is not set, you have to manually start the stream again
            /* await CameraStreamerReference.StartAsync(); */
        }
    }

    private async void Start()
    {
        await CameraStreamerReference.StartAsync();
    }

    private async void Stop()
    {
        await CameraStreamerReference.StopAsync();
    }

    private void OnFrameHandler(string _)
    {

    }

    private async void GetCurrentFrame()
    {
        imageData = await CameraStreamerReference.GetCurrentFrameAsync();
        var rand = new Random();
        var x = rand.Next(200, 280);
        var y = rand.Next(120, 150);
        TrackImage(x, y, 100, 200);
        TrackMood(EmotionType.Angry);
    }

    private void TrackImage(int x, int y, int width, int height)
    {
        trackingStyle = trackingStyle.ToTrackingStyle(x, y, width, height);
    }

    private void TrackMood(EmotionType emotion)
    {
        switch (emotion)
        {
            case EmotionType.Happy:
                trackingStyle = trackingStyle.ToColorStyle("green");
                moodText = "Happy";
                htmlColor = "green";
                break;
            case EmotionType.Sad:
                trackingStyle = trackingStyle.ToColorStyle("aqua");
                moodText = "Sad";
                htmlColor = "aqua";
                break;
            case EmotionType.Angry:
                trackingStyle = trackingStyle.ToColorStyle("red");
                moodText = "Angry";
                htmlColor = "red";
                break;
            default:
                trackingStyle = trackingStyle.ToColorStyle("grey");
                moodText = "Neutral";
                htmlColor = "grey";
                break;
        }
    }
}